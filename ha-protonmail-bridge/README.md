# Home Assistant Add-on: ProtonMail Bridge v3

Run the official ProtonMail Bridge v3.x as a Home Assistant add-on, enabling SMTP and IMAP access to your ProtonMail account from Home Assistant.

![Supports amd64 Architecture][amd64-shield]
![Supports aarch64 Architecture][aarch64-shield]

[amd64-shield]: https://img.shields.io/badge/amd64-yes-green.svg
[aarch64-shield]: https://img.shields.io/badge/aarch64-yes-green.svg

## About

This add-on runs the official [ProtonMail Bridge](https://github.com/ProtonMail/proton-bridge) v3.x binary inside a Docker container. It exposes SMTP (port 25 → internal 1025) and IMAP (port 143 → internal 1143) so you can send emails from Home Assistant using your ProtonMail account.

> **Note:** This is a fork of [fboulay/ha-addons-repository](https://github.com/fboulay/ha-addons-repository), updated to support ProtonMail Bridge v3.x which uses a gRPC API instead of the old interactive CLI.

## Supported Architectures

- **amd64**: Uses the official pre-built `.deb` binary from the ProtonMail Bridge releases.
- **aarch64**: Built from source (Go) during Docker build.

## Installation

1. Add this repository to your Home Assistant Add-on Store:
   ```
   https://github.com/merlindegrote/ha-protonmail-bridge-v3
   ```
2. Install the **ProtonMail Bridge v3** add-on.
3. Configure your ProtonMail credentials (username and password) in the add-on configuration.
4. Start the add-on.

## Configuration

```yaml
username: your@protonmail.com
password: your_protonmail_password
totp_code: ""
mailbox_password: ""
```

| Option | Required | Description |
|--------|----------|-------------|
| `username` | Yes | Your ProtonMail account email address |
| `password` | Yes | Your ProtonMail account password |
| `totp_code` | No | Optional 2FA/TOTP code (only needed if 2FA is enabled) |
| `mailbox_password` | No | Only for ProtonMail two-password mode; leave empty otherwise |

### English note (short)

In the add-on configuration you only enter your ProtonMail account (`username`, `password`) and optionally `totp_code` or `mailbox_password`. The IMAP/SMTP bridge password is generated automatically after the first login.

### Nederlandse uitleg (kort)

In de add-on configuratie geef je alleen je ProtonMail account (`username` en `password`) en eventueel `totp_code` op. Het IMAP/SMTP bridge-wachtwoord hoef je niet zelf in te vullen: dat wordt automatisch aangemaakt na de eerste login en daarna getoond/weggezet.

## Ports

| Port | Description |
|------|-------------|
| 25/tcp | SMTP port (Bridge forwards to internal port 1025) |
| 143/tcp | IMAP port (Bridge forwards to internal port 1143) |

## Home Assistant Email Configuration

Use these settings in your Home Assistant `configuration.yaml`:

```yaml
smtp:
  server: localhost
  port: 25
  sender: your@protonmail.com
  username: your@protonmail.com
  password: !secret protonmail_bridge_password
```

The SMTP password is the **Bridge password** generated by ProtonMail Bridge (not your ProtonMail account password). Check the add-on logs after first start to find the Bridge SMTP/IMAP credentials.

Kort: gebruik in je mailclient het automatisch gegenereerde bridge-wachtwoord, niet je ProtonMail account wachtwoord.

**Belangrijk**: het bridge-wachtwoord verschijnt niet in de add-on configuratiepagina. Je vindt het na de eerste start in de add-on logs en in `/data/bridge_credentials.json`.

**Important (EN)**: the bridge password does not appear on the add-on configuration page. After the first start, find it in the add-on logs and in `/data/bridge_credentials.json`.

**Important (FR)**: le mot de passe bridge ne se trouve pas dans la page de configuration. Apres le premier demarrage, vous le trouverez dans les logs de l'addon et dans `/data/bridge_credentials.json`.

## How It Works

- On first start, the Bridge will attempt to log in using the credentials from the add-on configuration via the gRPC API.
- The vault (credentials) is stored persistently in `/data`.
- Subsequent starts will reuse the stored credentials without requiring re-authentication.

## Changelog

See [CHANGELOG.md](CHANGELOG.md) for version history.

## Release / Update in Home Assistant

To make Home Assistant show an update in the add-on store UI, you must bump the add-on version and push it:

1. Update the version in `config.yaml`.
2. Update [CHANGELOG.md](CHANGELOG.md) if needed.
3. Commit and push to the repository.
4. In Home Assistant: refresh the add-on store and install the update when it appears.
